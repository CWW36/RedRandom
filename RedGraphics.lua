do -- MAP ARRAYS --

-- Map 0: Pallet Town
-- 19 blocks wide, 18 blocks tall
--       0     1     2     3     4     5     6     7     8     9     10    11    12    13    14    15    16    17    18
map0 = {{false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false,false},
				{false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false,false},
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,true ,true ,false,false,false,false,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,true ,true ,false,false,false,false,true ,true ,true },
				{false,true ,true ,false,false,true ,false,false,true ,true ,true ,false,false,true ,false,false,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,false,false,false,false,false,false,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,false,false,false,false,false,false,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,false,false,false,false,false,false,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,false,false,true ,false,false,false,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,true ,true ,true ,true ,true ,true ,false,false,false,false,false,false,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,true ,true ,true ,false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				{false,false,true ,true ,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false}}
-- Map 12: Route 1
-- 18 blocks wide, 36 blocks tall
--        0     1     2     3     4     5     6     7     8     9     10    11    12    13    14    15    16    17    
map12 = {{false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false},
				 {false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false},
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,false,false,true ,true ,true ,true ,false,false,false,false,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,false,false,false,false,false,false,false,false,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,false,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false},
				 {false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false},
				 {false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false},
				 {false,false,false,false,false,false,false,false,false,false,true ,true ,false,false,false,false,false,false}}
-- Map 37: Red's house F2
-- 8 blocks wide, 8 blocks tall
map37 = {{false,false,false,false,false,false,false,false},
				 {false,false,true ,false,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,false,false,false,true ,true },
				 {true ,true ,true ,false,false,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true }}
-- Map 38: Red's house F2
-- 8 blocks wide, 8 blocks tall
map38 = {{false,false,false,false,false,false,false,false},
				 {false,false,false,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,false,true ,true ,true ,true },
				 {true ,true ,true ,false,true ,true ,true ,true },
				 {false,true ,true ,true ,true ,true ,false,true },
				 {false,true ,true ,true ,true ,true ,false,true }}
-- Map 39: Blue's house
-- 8 blocks wide, 8 blocks tall
map39 = {{false,false,false,false,false,false,false,false},
				 {false,false,true ,true ,true ,true ,true ,false},
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,false,false,false,true ,true ,true },
				 {true ,true ,true ,false,false,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true },
				 {false,true ,true ,true ,true ,true ,true ,false},
				 {false,true ,true ,true ,true ,true ,true ,false}}
-- Map 40: Professor's Lab
-- 10 blocks wide, 12 blocks tall
map40 = {{false,false,false,false,false,false,false,false,false,false},
				 {false,false,false,false,true ,true ,false,false,false,false},
				 {true ,true ,true ,true ,true ,false,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,false,false,false,true },
				 {true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {false,false,false,false,true ,true ,false,false,false,false},
				 {false,false,false,false,true ,true ,false,false,false,false},
				 {true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,true ,true ,true ,true ,true ,true ,true ,true },
				 {true ,true ,false,true ,true ,true ,true ,true ,false,true },
				 {true ,true ,true ,true ,true ,true ,true ,true ,true ,true }}
end

function draw_map(canvas,map_number)
	local map_array = MAPS[map_number]
	local offset_x = OFFSETS[map_number][1]
	local offset_y = OFFSETS[map_number][2]
	for row = 1,#map_array do
		for col = 1,#map_array[1] do
			if map_array[row][col] then
				canvas.DrawRectangle(offset_x+(col-1)*SIZE,offset_y+(row-1)*SIZE,SIZE,SIZE,"white")
			end
		end
	end
end

function draw_position(canvas,position,fill_color,line_color)
	if not check_position(position) then
		return
	end
	local pos_map = position[1]
	canvas.DrawRectangle(OFFSETS[pos_map][1]+SIZE*position[2],OFFSETS[pos_map][2]+SIZE*position[3],SIZE,SIZE,fill_color,line_color)
end

function check_position(position)
	if MAPS[position[1]] == nil then
		return false
	end
	return MAPS[position[1]][position[3]+1][position[2]+1]
end
function positions_gradient()
	local positions_file = io.open(positions_name,"r")
	io.input(positions_file)
	local read_number = io.read("*line")
	if POSITION_GRADIENT_MODE == "rank" then
		for i=1,read_number do
			local read_position = {io.read("*number"),io.read("*number"),io.read("*number"),io.read("*number")}
			draw_position(new_canvas,read_position,color_gradient(HIGH_GRADIENT_COLOR,LOW_GRADIENT_COLOR,read_number,i),black)
		end
	elseif POSITION_GRADIENT_MODE == "frames" then
		local read_position = {io.read("*number"),io.read("*number"),io.read("*number"),io.read("*number")}
		local max_frames = read_position[4]
		draw_position(new_canvas,read_position,color_gradient(LOW_GRADIENT_COLOR,HIGH_GRADIENT_COLOR,max_frames,read_position[4]),black)
		for i=1,read_number-1 do
			local read_position = {io.read("*number"),io.read("*number"),io.read("*number"),io.read("*number")}
			draw_position(new_canvas,read_position,color_gradient(LOW_GRADIENT_COLOR,HIGH_GRADIENT_COLOR,max_frames,read_position[4]),black)
		end
	elseif POSITION_GRADIENT_MODE == "logframes" then
		local read_position = {io.read("*number"),io.read("*number"),io.read("*number"),io.read("*number")}
		local max_logframes = math.log(read_position[4])
		draw_position(new_canvas,read_position,color_gradient(LOW_GRADIENT_COLOR,HIGH_GRADIENT_COLOR,max_logframes,math.log(read_position[4])),black)
		for i=1,read_number-1 do
			local read_position = {io.read("*number"),io.read("*number"),io.read("*number"),io.read("*number")}
			draw_position(new_canvas,read_position,color_gradient(LOW_GRADIENT_COLOR,HIGH_GRADIENT_COLOR,max_logframes,math.log(read_position[4])),black)
		end
	end
	positions_file:close()
end

function color_gradient(min_color_array,max_color_array,max_value,value)
	return to_color(math.floor(min_color_array[1]*value/max_value)+math.floor(max_color_array[1]*(max_value-value)/max_value),
									math.floor(min_color_array[2]*value/max_value)+math.floor(max_color_array[2]*(max_value-value)/max_value),
									math.floor(min_color_array[3]*value/max_value)+math.floor(max_color_array[3]*(max_value-value)/max_value),
									math.floor(min_color_array[4]*value/max_value)+math.floor(max_color_array[4]*(max_value-value)/max_value))
end

function to_color(AA,RR,GG,BB)
	return AA*16777216+RR*65536+GG*256+BB
end

function create_graphics_variables()
	OFFSETS = {}
	OFFSETS[0]  = {8 *SIZE+5,0 *SIZE+5}
	OFFSETS[12] = {24*SIZE+5,0 *SIZE+5}
	OFFSETS[37] = {0 *SIZE+5,8 *SIZE+5}
	OFFSETS[38] = {0 *SIZE+5,0 *SIZE+5}
	OFFSETS[39] = {0 *SIZE+5,16*SIZE+5}
	OFFSETS[40] = {0 *SIZE+5,24*SIZE+5}

	MAPS = {}
	MAPS[0]  = map0
	MAPS[12] = map12
	MAPS[37] = map37
	MAPS[38] = map38
	MAPS[39] = map39
	MAPS[40] = map40
	
	POKEMON = {}
	POKEMON[1] = "Rhydon"
	POKEMON[2] = "Kangaskhan"
	POKEMON[3] = "Nidoran♂"
	POKEMON[4] = "Clefairy"
	POKEMON[5] = "Spearow"
	POKEMON[6] = "Voltorb"
	POKEMON[7] = "Nidoking"
	POKEMON[8] = "Slowbro"
	POKEMON[9] = "Ivysaur"
	POKEMON[10] = "Exeggutor"
	POKEMON[11] = "Lickitung"
	POKEMON[12] = "Exeggcute"
	POKEMON[13] = "Grimer"
	POKEMON[14] = "Gengar"
	POKEMON[15] = "Nidoran♀"
	POKEMON[16] = "Nidoqueen"
	POKEMON[17] = "Cubone"
	POKEMON[18] = "Rhyhorn"
	POKEMON[19] = "Lapras"
	POKEMON[20] = "Arcanine"
	POKEMON[21] = "Mew"
	POKEMON[22] = "Gyarados"
	POKEMON[23] = "Shellder"
	POKEMON[24] = "Tentacool"
	POKEMON[25] = "Gastly"
	POKEMON[26] = "Scyther"
	POKEMON[27] = "Staryu"
	POKEMON[28] = "Blastoise"
	POKEMON[29] = "Pinsir"
	POKEMON[30] = "Tangela"
	POKEMON[33] = "Growlithe"
	POKEMON[34] = "Onix"
	POKEMON[35] = "Fearow"
	POKEMON[36] = "Pidgey"
	POKEMON[37] = "Slowpoke"
	POKEMON[38] = "Kadabra"
	POKEMON[39] = "Graveler"
	POKEMON[40] = "Chansey"
	POKEMON[41] = "Machoke"
	POKEMON[42] = "Mr. Mime"
	POKEMON[43] = "Hitmonlee"
	POKEMON[44] = "Hitmonchan"
	POKEMON[45] = "Arbok"
	POKEMON[46] = "Parasect"
	POKEMON[47] = "Psyduck"
	POKEMON[48] = "Drowzee"
	POKEMON[49] = "Golem"
	POKEMON[51] = "Magmar"
	POKEMON[53] = "Electabuzz"
	POKEMON[54] = "Magneton"
	POKEMON[55] = "Koffing"
	POKEMON[57] = "Mankey"
	POKEMON[58] = "Seel"
	POKEMON[59] = "Diglett"
	POKEMON[60] = "Tauros"
	POKEMON[64] = "Farfetch'd"
	POKEMON[65] = "Venonat"
	POKEMON[66] = "Dragonite"
	POKEMON[70] = "Doduo"
	POKEMON[71] = "Poliwag"
	POKEMON[72] = "Jynx"
	POKEMON[73] = "Moltres"
	POKEMON[74] = "Articuno"
	POKEMON[75] = "Zapdos"
	POKEMON[76] = "Ditto"
	POKEMON[77] = "Meowth"
	POKEMON[78] = "Krabby"
	POKEMON[82] = "Vulpix"
	POKEMON[83] = "Ninetales"
	POKEMON[84] = "Pikachu"
	POKEMON[85] = "Raichu"
	POKEMON[88] = "Dratini"
	POKEMON[89] = "Dragonair"
	POKEMON[90] = "Kabuto"
	POKEMON[91] = "Kabutops"
	POKEMON[92] = "Horsea"
	POKEMON[93] = "Seadra"
	POKEMON[96] = "Sandshrew"
	POKEMON[97] = "Sandslash"
	POKEMON[98] = "Omanyte"
	POKEMON[99] = "Omastar"
	POKEMON[100] = "Jigglypuff"
	POKEMON[101] = "Wigglytuff"
	POKEMON[102] = "Eevee"
	POKEMON[103] = "Flareon"
	POKEMON[104] = "Jolteon"
	POKEMON[105] = "Vaporeon"
	POKEMON[106] = "Machop"
	POKEMON[107] = "Zubat"
	POKEMON[108] = "Ekans"
	POKEMON[109] = "Paras"
	POKEMON[110] = "Poliwhirl"
	POKEMON[111] = "Poliwrath"
	POKEMON[112] = "Weedle"
	POKEMON[113] = "Kakuna"
	POKEMON[114] = "Beedrill"
	POKEMON[116] = "Dodrio"
	POKEMON[117] = "Primeape"
	POKEMON[118] = "Dugtrio"
	POKEMON[119] = "Venomoth"
	POKEMON[120] = "Dewgong"
	POKEMON[123] = "Caterpie"
	POKEMON[124] = "Metapod"
	POKEMON[125] = "Butterfree"
	POKEMON[126] = "Machamp"
	POKEMON[128] = "Golduck"
	POKEMON[129] = "Hypno"
	POKEMON[130] = "Golbat"
	POKEMON[131] = "Mewtwo"
	POKEMON[132] = "Snorlax"
	POKEMON[133] = "Magikarp"
	POKEMON[136] = "Muk"
	POKEMON[138] = "Kingler"
	POKEMON[139] = "Cloyster"
	POKEMON[141] = "Electrode"
	POKEMON[142] = "Clefable"
	POKEMON[143] = "Weezing"
	POKEMON[144] = "Persian"
	POKEMON[145] = "Marowak"
	POKEMON[147] = "Haunter"
	POKEMON[148] = "Abra"
	POKEMON[149] = "Alakazam"
	POKEMON[150] = "Pidgeotto"
	POKEMON[151] = "Pidgeot"
	POKEMON[152] = "Starmie"
	POKEMON[153] = "Bulbasaur"
	POKEMON[154] = "Venusaur"
	POKEMON[155] = "Tentacruel"
	POKEMON[157] = "Goldeen"
	POKEMON[158] = "Seaking"
	POKEMON[163] = "Ponyta"
	POKEMON[164] = "Rapidash"
	POKEMON[165] = "Rattata"
	POKEMON[166] = "Raticate"
	POKEMON[167] = "Nidorino"
	POKEMON[168] = "Nidorina"
	POKEMON[169] = "Geodude"
	POKEMON[170] = "Porygon"
	POKEMON[171] = "Aerodactyl"
	POKEMON[173] = "Magnemite"
	POKEMON[176] = "Charmander"
	POKEMON[177] = "Squirtle"
	POKEMON[178] = "Charmeleon"
	POKEMON[179] = "Wartortle"
	POKEMON[180] = "Charizard"
	POKEMON[185] = "Oddish"
	POKEMON[186] = "Gloom"
	POKEMON[187] = "Vileplume"
	POKEMON[188] = "Bellsprout"
	POKEMON[189] = "Weepinbell"
	POKEMON[190] = "Victreebel"
end

-- VARIABLES TO EDIT --
SIZE = 10
SHOW_CURRENT_POSITION = false
DO_POSITION_GRADIENT = false
SHOW_POKEMON_INFO = true

POSITION_GRADIENT_MODE = "rank" -- options are: "rank", "frames", "logframes"
LOW_GRADIENT_COLOR = {255,255,0,0} -- AARRGGBB array
HIGH_GRADIENT_COLOR = {255,0,0,255} -- AARRGGBB array
BACKGROUND_COLOR = "gray" -- luacolor

---- MAIN ----
graphics_pos = {0,0,0}
-- INITIALIZE CANVAS --
create_graphics_variables()
if SHOW_CURRENT_POSITION or DO_POSITION_GRADIENT then
	new_canvas = gui.createcanvas(42*SIZE+10,37*SIZE)
	new_canvas.DrawRectangle(0,0,42*SIZE+10,37*SIZE,BACKGROUND_COLOR,BACKGROUND_COLOR)
	new_canvas.SetTitle("RedGraphics")
	draw_map(new_canvas,0 )
	draw_map(new_canvas,12)
	draw_map(new_canvas,37)
	draw_map(new_canvas,38)
	draw_map(new_canvas,39)
	draw_map(new_canvas,40)
	client.SetGameExtraPadding(0,0,0,8)
end
if SHOW_POKEMON_INFO then
	client.SetGameExtraPadding(0,0,0,24)
end
while true do
	if DO_POSITION_GRADIENT then
		if frame%update_multiple == 0 and emu.framecount() ~= 0 then
			positions_gradient(10)
			new_canvas.Refresh()
		end
	end
	if SHOW_CURRENT_POSITION then
		if graphics_pos ~= current_position then
			draw_position(new_canvas,graphics_pos,nil,"black")
			graphics_pos = current_position
			draw_position(new_canvas,graphics_pos,nil,to_color(255,0,255,0))
			new_canvas.Refresh()
		end
	end
	if SHOW_POKEMON_INFO then
		currpokemon = memory.readbyte(0xD164)
		if POKEMON[currpokemon] ~= nil then
			currlevel = memory.readbyte(53644)
			currhp = 128*memory.readbyte(53612)+memory.readbyte(53613)
			maxhp = 128*memory.readbyte(53645)+memory.readbyte(53646)
			gui.text(0,288,"Pokemon: "..POKEMON[currpokemon].." Level "..currlevel)
			if currlevel < 100 then
				currexp = memory.readbyte(53625)*256*256 + memory.readbyte(53626)*256 + memory.readbyte(53627)
				tonextlevel = math.floor(6/5 * (currlevel+1)^3 - 15*(currlevel+1)^2 + 100*(currlevel+1) - 140)
				gui.text(0,288+16,"HP: "..currhp.."/"..maxhp..", EXP:"..currexp.."/"..tonextlevel)
			else
				gui.text(0,288+16,"HP: "..currhp.."/"..maxhp)
			end
		end
	end
	emu.frameadvance()
end
